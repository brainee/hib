;(function(k,n,A){if(!k.JSON||!k.JSON.parse||!k.JSON.stringify||"undefined"==typeof localStorage)return 0;if(!k.$_bf||!0!==k.$_bf.loaded)try{var v=n.documentElement,G=function(){},w={undefined:"undefined",number:"number","boolean":"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error","[object Object]":"object"},B=1,H=w.toString,I=/\$\{(\w+)\}/g,J=/((test[a-z]?|dev|uat|ui|local)\.sh\.(ctrip|huixuan)travel)|(qa\.nt\.ctripcorp)/i,
x="",t="",y="",u="",z="",C="",K=2,D=!1;k.$_bf=k.$_bf||{};k.$_bf.version="1.1.0";k.$_bf.loaded=!0;var c=function(){var a=navigator,b=screen.colorDepth+"-bit";C=(a.language||a.browserLanguage||"").toLowerCase();var d={version:"1.1.0",readyMax:30,isReady:!1,enter:(new Date).getTime(),watchdog:function(a,h,b){},now:Date.now||function(){return(new Date).getTime()},toint:function(a){return parseInt(a,10)||0},plus:function(a){return d.toint(a)+1},type:function(a){return w[typeof a]||w[H.call(a)]||(a?"object":
"null")},isArray:function(a){return"array"==d.type(a)},isFunction:function(a){return"function"==d.type(a)},isEmpty:function(a){return a===A||"-"==a||""==a},getRand:function(){return(""+Math.random()).slice(-8)},hash:function(a){var b=1,e=0,g;if(!d.isEmpty(a)){b=0;for(g=a.length-1;0<=g;g--)e=a.charCodeAt(g),b=(b<<6&268435455)+e+(e<<14),e=b&266338304,b=0!=e?b^e>>21:b;return b}},getHash:function(){var f=[a.appName,a.appVersion,a.platform,a.userAgent,screen.width+screen.height,b,n.cookie?n.cookie:"",
t].join("");return d.hash(f)},$:function(a){return"string"!==typeof a?!1:n.getElementById(a)},$v:function(a){return(a=d.$(a))&&a.value||""},send:function(a,b){if("string"!==typeof a)return!1;var e=y+"/bf.gif?",g=new Image;g.onload=function(){g=g.onload=g.onerror=null;b&&d.isFunction(b)&&b(1)};g.onerror=function(){g=g.onload=g.onerror=null;b&&d.isFunction(b)&&b(0)};g.src=e+a+"&rd="+c.now()+"&jv=1.1.0";return!0},decode:function(a){return decodeURIComponent(a)},encode:function(a){return encodeURIComponent(a)},
getCookie:function(a,b,e){return(a=n.cookie.match(RegExp("(^| )"+a+"=([^;]*)(;|$)")))?e?d.decode(a[2]):a[2]:b||""},getCookieObj:function(a,b){var e={__k:a},g=[],c;if(g=d.getCookie(a,"",b))for(var g=g.split("&")||[],p=0;p<g.length;p++)c=g[p].split("="),1<c.length&&(e[c[0]]=c[1]);return e},setCookie:function(a,b,e){var g=x?";domain="+x:"",c="";0<=e&&(c=";expires="+(new Date(d.now()+e)).toUTCString());n.cookie=a+"="+d.encode(b)+g+";path=/"+c},getItem:function(a,b){var e=localStorage.getItem(a)||"";if(e&&
b)try{e=JSON.parse(e)}catch(g){e=""}return e},setItem:function(a,b){"object"==typeof b&&(b=JSON.stringify(b));"string"===typeof b&&localStorage.setItem(a,b)},extend:function(){var a,b,e,g=arguments[0]||{},d=1,c=arguments.length;c===d&&(g=this,--d);for(;d<c;d++)if(null!=(e=arguments[d]))for(b in e)a=e[b],g!==a&&a!==A&&(g[b]=a);return g},uniqueID:function(){return d.getRand()^d.getHash()&2147483647},grab:function(a,b){var e,g={};b=b||{};g.v=b.v||"";g.w=b.w||"default";g.l=b.l||0;g.t=b.t||"string";switch(g.w){case "input":e=
d.$v(a);break;case "cookie":e=d.getCookie(a,g.v);break;case "function":e=d.isFunction(g.v)?g.v():"";break;default:e=g.v}switch(g.t){case "number":return d.toint(e);case "boolean":return!!e;default:return g.l?String(e).substring(0,g.l):e}},getTagIndex:function(a){var b=0;if(a.parentNode)for(var e=a.parentNode.firstChild;e&&e!=a;)1==e.nodeType&&e.tagName==a.tagName&&b++,e=e.nextSibling;return 0<b?"["+ ++b+"]":""},getXpath:function(a){for(var b=[],e=0,g;a&&9!=a.nodeType;){var c=a.nodeName+d.getTagIndex(a)+
(a.id?"[@id='"+a.id+"']":"");if(g=a.getAttribute("block"))c+="[@block='"+g+"']";b[e++]=c;a=a.parentNode}return b.reverse().join("/")},initDomin:function(a){a=a||location.hostname;if(/^(\d|\.)+$/.test(a))return a;var b="",e=a.split(".").reverse(),b=e[1]+"."+e[0];/com\.\w{2,}$/i.test(a)&&(b=e[2]+"."+b);return b},initEnv:function(a){var b="file:"==z?"http:":z;y=!0===D?"http://localhost":"dev"==a?b+"//10.3.6.192:8086":"test"==a?b+"//ubt.uat.qa.nt.ctripcorp.com":"offline"==a?b+"//ubt.sh.ctriptravel.com":
"uat"==a||J.test(u)?b+"//ubt.uat.qa.nt.ctripcorp.com":b+"//s.c-ctrip.com"},init:function(){var a=k.location||n.location,b=a.hostname;z=a.protocol;x=d.initDomin(b);u=a.href;d.initEnv("string"==typeof k.$_bf.env?k.$_bf.env:"online");a="";try{a=n&&n.referrer}catch(e){}if(""==a&&k.opener)try{a=k.opener.location.href}catch(c){}t=a}};d.init();return d}();(function(a){function b(a){var b=0,e=[],c=0;this.n=function(){if(0==c){if(b>=a.length)return null;var d=a.charCodeAt(b++);if(127>=d)return d;if(2047>=
d)return e[1]=128|d&63,c=1,192|d>>6&31;if(55296<=d&&57343>=d)throw"unsupported char code.";e[0]=128|d>>6&63;e[1]=128|d&63;c=2;return 224|d>>12&15}return e[e.length-c--]}}function d(a){var b=new function(a){for(var b=[],e=-1,d;null!=(d=a.n());)if(0==d[0]){if(-1==e||255==b[e])b.push(128),e=b.length-1;b.push(d[1]);b[e]++}else{e=-1;b.push(d[0]);var c=d[1];if(127>=c)b.push(c);else{for(d=[];0<c;)d.push(c&127),c>>=7;for(c=d.length-1;0<=c;c--)b.push(d[c]|128);b[b.length-1]&=127}}e=0;this.n=function(){return e>=
b.length?null:b[e++]}}(new function(a){function b(a,d){for(var c=0,e=0;e<g;e++)c=131*c+a[d+e];return c}for(var d=[],c=[],f=[],l,p=0,k,m;null!=(l=a.n());)f.push(l);this.n=function(){if(p<f.length-g+1){for(var a=b(f,p),l=m=k=0;l<c.length;l++)if(a==c[l]){var s,n;s=l;for(n=p;s<d.length&&n<f.length&&!(d[s]!=f[n]||n-p>=e);s++,n++);s-l>=m&&s-l>=g&&(m=s-l,k=l)}if(0==m)return a=[0,f[p]],l=f[p++],d.push(l),d.length>h&&(d.shift(),c.shift()),d.length>=g&&(l=d.length-g,c[l]=b(d,l)),a;p+=m;return[m,d.length-(k+
m)]}if(p<f.length)return[0,f[p++]]}}(a));this.n=function(){return b.n()}}function c(a){var b=[],d=0;this.n=function(){if(0<d)return b[4-d--];var c=[a.n(),a.n(),a.n()];if(null==c[0])return null;b[0]=l.charAt(c[0]>>2);b[1]=null==c[1]?l.charAt(c[0]<<4&63):l.charAt((c[0]<<4|c[1]>>4)&63);b[2]=null==c[1]?"~":null==c[2]?l.charAt(c[1]<<2&63):l.charAt((c[1]<<2|c[2]>>6)&63);b[3]=null==c[2]?"~":l.charAt(c[2]&63);d=3;return b[0]}}var h=1024,e=63,g=3,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";
a.compress=function(a){a=new b(a);a=new d(a);a=new c(a);for(var e,g=[];null!=(e=a.n());)g[g.length]=e;return g.join("")}})(c);var r=function(a,b){function c(){f.queueCheck(!0,"useraction");f.queueCheck(!0,"matrix");f.status.destroyed&&f.status.pv||setTimeout(c,5E3)}this.status={destroyed:!1,isnewvid:0,islogin:0,pvready:!1,pv:!1,ps:!1};this.data={orderid:"",abtest:"",pid:0,vid:"",sid:0,pvid:0,tid:"",ppv:0,ppi:0};this.queue={};this.init(a,b);this.initUBT();var f=this;c()};r.prototype={constructor:r,
init:function(a,b){if("object"===typeof a){"undefined"!=typeof a.page_id&&(this.data.pid=c.toint(a.page_id));"string"==typeof a.url&&(u=a.url);if("string"==typeof a.orderid||"number"==typeof a.orderid)this.data.orderid=a.orderid;"string"==typeof a.refer&&(t=a.refer);a.tid&&(this.data.tid=(""+a.tid).substring(0,30))}this.pvcallback=c.isFunction(b)?b:G},initUBT:function(){var a,b=0,d=0,f=0,f=0,h=c.getItem("CTRIP_UBT_M",!0);h&&h.vid&&h.create?(a=h.vid,b=h.sid,d=c.plus(h.pvid),f=h.sid_ts,18E5<c.now()-
f?(b=c.plus(b),this.data.ppi=0,this.data.ppv=0):(this.data.ppi=h.pid||0,this.data.ppv=h.pvid||0),f=h.create):((d=this.readOldBfa())&&6<d.length?(a=d[1]+"."+d[2],b=c.plus(d[6]),d=c.plus(d[7])):(this.status.isnewvid=1,a=c.enter+"."+c.uniqueID().toString(36),d=b=1),f=c.enter);this.data.vid=a;this.data.sid=b;this.data.pvid=d;this.data.ubt={pid:this.getPid(),vid:a,sid:b,pvid:d,sid_ts:c.now(),create:f};this.updateUBT()},updateUBT:function(a){"number"==typeof a&&(this.data.ubt.pid=a);c.setItem("CTRIP_UBT_M",
this.data.ubt)},readOldBfa:function(){var a=c.getCookie("_bfa","",!0);a||(a=c.getItem("_bfa"));if(a&&(a=a.split("."),6<a.length)){try{localStorage.removeItem("_bfa"),localStorage.removeItem("_bfs"),localStorage.removeItem("_bfi")}catch(b){}return a}return!1},getPid:function(){this.data.pid||(this.data.pid=c.toint(c.$v("page_id")));return this.data.pid},getABtest:function(){for(var a=c.$("ab_testing_tracker"),b=[],d="";a;)d+=a.value,b.push(a),a.removeAttribute("id"),a.removeAttribute("name"),a=c.$("ab_testing_tracker");
for(a=0;a<b.length;a++)b[a].setAttribute("id","ab_testing_tracker");b="";(b=n.location.hash)&&-1!==b.indexOf("abtest=")&&(d+=decodeURIComponent(b.replace(/.*(abtest=)/i,"").replace(/#.*/i,"")));return d.substring(0,280)},get:function(a){if("string"!=typeof a)return"";switch(a){case "vid":case "sid":case "pvid":return this.data[a];case "islogin":case "isnewvid":return this.status[a];case "fullpv":return this.data.vid+"."+this.data.sid+"."+this.data.pvid}},getCommon:function(a){a=[];a[0]=this.getPid();
a[1]=this.data.vid;a[2]=this.data.sid;a[3]=this.data.pvid;a[4]=this.data.tid;a[5]=this.getABtest();a[6]="";return a},getUinfo:function(){var a=this.getDatum(),b=[10];b[1]=this.data.ppi;b[2]=this.data.ppv;b[3]=u;b[4]=screen.width;b[5]=screen.height;b[6]="";b[7]=C;b[8]=a.engine;b[9]=a.keyword;b[10]=t;b[11]=this.getABtest();b[12]=this.status.isnewvid;b[13]=this.status.islogin;b[14]=a.user_id;b[15]=a.user_grade;b[16]=a.corpid;b[17]=a.start_city;b[18]=a.alliance_id;b[19]=a.alliance_sid;b[20]=a.alliance_ouid;
b[21]=this.data.orderid;b[22]=a.duid;b[23]=a.zdata;b[24]=a.callid;b[25]=a.bid;b[26]=c.getItem("GUID");b[27]=c.getItem("SOURCEID");b[28]=a.appinfo;return b},getDatum:function(){if(this.data.business)return this.data.business;var a=c.getCookieObj("Session"),b=c.getCookieObj("CtripUserInfo"),d=c.getCookieObj("StartCity_Pkg"),f=c.getCookieObj("Union"),a={engine:a&&a.SmartLinkCode||"",keyword:a&&a.SmartLinkQuary||"",start_city:d&&d.PkgStartCity||"",alliance_id:f&&f.AllianceID?f.AllianceID:"",alliance_sid:f&&
f.SID?f.SID:"",alliance_ouid:f&&f.OUID?f.OUID:"",user_id:c.getCookie("login_uid",""),user_grade:b&&b.VipGrade||"",corpid:c.getCookie("corpid",""),duid:b&&b.U||"",zdata:c.getCookie("zdatactrip",""),callid:c.$v("bf_ubt_tl_callid")||"",bid:""};try{if(!a.alliance_id){var h=c.getItem("UNION",!0);h&&h.data&&(h.st||h.timeout)&&(b=0,(b=h.st?new Date(h.st):new Date(h.timeout.replace(/-/g,"/")))&&b>=h.enter&&(a.alliance_id=f.AllianceID||f.ALLIANCEID||"",a.alliance_sid=f.SID||"",a.alliance_ouid=f.OUID||""))}}catch(e){}if(!a.user_id&&
!a.duid)try{var g=c.getItem("USER",!0);if(g&&g.value){var l=g.value;a.user_id=l.LoginName||l.UserID||"";a.user_grade=l.VipGrade||""}}catch(k){}if(a.duid||a.user_id&&a.user_grade)this.status.islogin=1;this.data.orderid||(this.data.orderid=c.$v("bf_ubt_orderid"));this.data.tid||(this.data.tid=c.$v("CorrelationId"));f=c.getItem("APPINFO",!0);a.appinfo="object"==typeof f?'{"version":'+(f.version||"")+',"platform":'+(f.platform||"")+"}":"";return this.data.business=a},sendPV:function(){if(this.status.pvready)return!1;
try{this.getDatum();var a={c:this.getCommon(!0),d:{uinfo:this.getUinfo()}},b="ac=g&d="+c.encode(JSON.stringify(a)),d=this;c.send(b,function(a){if(a){if(d.status.pv=!0,d.sendPS(),d.pvcallback(a),a=d.queue["default"])for(var b=0;b<a.length;b++){var g=a[b],f=d.dataHandler(g);f&&c.send(f,g.callback)}}else 0<--K&&d.sendPV()});this.updateUBT(this.getPid());this.status.pvready=!0}catch(f){}},getPS:function(){for(var a="navigationStart redirectStart unloadEventStart unloadEventEnd redirectEnd fetchStart domainLookupStart domainLookupEnd connectStart connectEnd requestStart responseStart responseEnd domLoading domInteractive domContentLoadedEventStart domContentLoadedEventEnd domComplete loadEventStart loadEventEnd".split(" "),
b=k.performance.timing,c=[6],f=0;f<a.length;f++)c.push(b[a[f]]);c.push(k.performance.navigation.type||0);c.push(k.performance.navigation.redirectCount||0);return c},sendPS:function(){function a(){if(k.performance.timing.loadEventEnd){var f={c:d.getCommon(),d:{ps:d.getPS()}},f="ac=g&d="+c.encode(JSON.stringify(f));c.send(f);return d.status.ps=!0}300>b&&(b++,setTimeout(a,1E3))}if(k.performance&&!this.status.ps){var b=0,d=this;try{a()}catch(f){}}},replaceParam:function(a){var b={duid:this.getDatum().duid,
page_id:this.getPid(),is_login:this.status.islogin};return a.replace(I,function(a,c){return c in b?b[c]:a})},dataHandler:function(a){if("string"==typeof a)return a;if("object"==typeof a){if(a.c&&a.d)return a={c:this.getCommon(),d:a.d},"ac=g&d="+c.encode(JSON.stringify(a));if(a.k&&a.v){var b=c.encode(this.replaceParam(a.v));return"ac=tl&pi="+this.getPid()+"&key="+a.k+"&val="+b+"&pv="+this.get("fullpv")+"&v=6"}}},sendData:function(a){if(this.status.pv){var b=this.dataHandler(a);b&&c.send(b,a.callback)}else this.queuePush("default",
a)},queuePush:function(a,b){this.queue[a]||(this.queue[a]=[]);this.queue[a].push(b);this.queueCheck(!1,a)},queueCheck:function(a,b){if(!this.status.pv||"default"==b)return!1;var c=this.queue[b];if(c){var f=c.length;if(5<f||a&&0<f)c=c.splice(0,5),c=[[1,b],this.getCommon(),c],this.queueSend(c)}},queueSend:function(a){var b="";try{b=c.compress(JSON.stringify(a))}catch(d){}b&&c.send("ac=a&d="+b)},destroy:function(){this.queueCheck(!0,"useraction");this.queueCheck(!0,"matrix");this.status.destroyed=!0},
ready:function(){c.isReady&&this.sendPV()}};var m=new r;(function(){var a=!1,b={_setDebug:function(a){a&&(D=!0,y="http://localhost")},_setEnv:function(a){"string"===typeof a&&c.initEnv(a)},_getFullPV:function(a){var b=m.get("fullpv");a&&c.isFunction(a)&&a(b);return b},_unload:function(a){("undefined"!=typeof $&&$.bindFastClick||"object"==typeof Lizard)&&1==B?B=0:(m.status.pvready||m.sendPV(),m.destroy(),m=new r)},_asynRefresh:function(a,b){m.status.pvready?(m.destroy(),m=new r(a||{},b)):m.init(a,
b);m.sendPV()},_tracklog:function(a,b,d){if(!b||"string"!=typeof b||"string"!=typeof a)return c.isFunction(d)&&d(0),!1;m.sendData({k:a,v:b,callback:d})},_trackError:function(b,d){if("object"!=typeof b)return!1;if(a)return a=!1;!0===b.skip&&(a=!0);for(var f="version message line file category framework time repeat islogin name column".split(" "),h=[7,"",0,"","","",c.now()-c.enter,1,m.get("islogin"),"",0],k=1,n=f.length;k<n;k++){var r=f[k];if(b[r]){var q=b[r]+"";switch(r){case "message":case "file":q=
q.substring(0,500);break;case "category":case "framework":case "name":q=q.substring(0,100);break;case "time":q=parseInt(q,10);break;case "column":q=parseInt(q,10);break;default:q=parseInt(q,10)||0}h[k]=q}}h.push("trace");m.sendData({c:!0,d:{error:h},callback:d})},_trackUserBlock:function(a,b){if("object"!=typeof a)return!1;var d=[6];d[1]=m.get("islogin");d[2]=String(a.message||"").substring(0,300);d[3]=String(a.value||"").substring(0,300);d[4]=String(a.type||"").substring(0,50);d[5]=String(a.dom||
"").substring(0,100);d[6]=String(a.form||"").substring(0,100);d[7]=c.toint(a.count||0,10);m.sendData({c:!0,d:{ub:d},callback:b})},_trackMatrix:function(a,b,d,f,h){f="number"==typeof f?f:c.now();var k=0;"string"===typeof a&&"object"===typeof b&&"number"===typeof d&&(m.queuePush("matrix",{name:a,tags:b,value:d,ts:f}),k=1);c.isFunction(h)&&h(k)},push:function(a){var d;return c.isArray&&(d=a[0],"_"==d[0]&&c.isFunction(b[d]))?b[d].apply(b,a.slice(1)):!1}};if(c.isArray(k.__bfi)){var d=k.__bfi,f=d.length;
if(0<f)for(var h=0;h<f;h++)b.push(d[h])}else k.__bfi=[];k.__bfi.push=b.push;c.extend(k.$_bf,{_getFullPV:b._getFullPV,tracklog:b._tracklog,trackError:b._trackError,asynRefresh:b._asynRefresh})})();var E=function(){var a=c.$v("page_id");"wait"!=a&&(a=c.toint(a),0!=a?c.isReady=!0:"complete"==n.readyState?c.isReady=!0:0>=c.readyMax&&(c.isReady=!0));if(!c.isReady&&0<c.readyMax)c.readyMax--,setTimeout(E,500);else return m.ready()};E();n.addEventListener("click",function(a){var b=a.target||a.srcElement,
d=b.nodeName.toUpperCase();if(b.getBoundingClientRect){var f=b.getBoundingClientRect(),h="",e=Math.max(v.scrollLeft,n.body.scrollLeft),g=Math.max(v.scrollTop,n.body.scrollTop),k=a.pageX||a.clientX+e;a=a.pageY||a.clientY+g;var p=parseInt((v.clientWidth||n.body.clientWidth)/2,10);"SELECT"==d&&0>a-f.top-g?(h+="[@x='"+parseInt(k+f.left+e-p,10)+"'][@y='"+parseInt(a+f.top,10)+"']",h=h+("[@rx='"+k+"']")+("[@ry='"+(a-g)+"']")):(h+="[@x='"+(k-p)+"'][@y='"+a+"']",h+="[@rx='"+parseInt(k-f.left-e,10)+"']",h+=
"[@ry='"+parseInt(a-f.top-g,10)+"']");m.queuePush("useraction",{action:"click",xpath:c.getXpath(b)+h,ts:c.now()})}});if(null===k.onerror){var F={};k.onerror=function(){try{var a=arguments,b={message:""+a[0],file:""+a[1],category:"inner-error",framework:"normal",time:c.now()-c.enter,line:a[2],column:a[3],repeat:1},d="err_"+c.hash(b.message+b.file+b.line);F[d]||(__bfi.push(["_trackError",b]),F[d]=!0)}catch(f){}}}}catch(L){}})(window,document);
